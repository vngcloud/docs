# Container lifecycle

Lifecycle is a feature developed by VNG Cloud that allows you to set up actions that vStorage applies to a container. We define the following two types of rules to help you manage the container lifecycle:

<figure><img src="../../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

In there:

* Transition rule: Rule supports moving objects between storage classes. You can set up one or more lifecycle rules to move objects if within N days the object has not been accessed.
  * From storage class Gold to storage class Silver.
  * From storage class Gold to storage class Archive.
* Expiration rule: Rule supports deleting objects according to binding conditions. You can set up one or more lifecycle rules to delete objects after a certain period of time from the date the object exists on the vStorage system. You can set up the lifecycle to:
  * Delete an object belonging to Storage Class Gold.
  * Delete object belonging to Storage Class Silver.

{% hint style="info" %}
**Note:**

* Processing objects during a lifecycle rule run depends on the number of objects in the container for which your lifecycle rule is set and the workload of our system. If the container has many objects or the system has a high load, processing will be slow and drag on over the following days. If the container has few objects or the system has a low load, processing is fast and can be completed in a day. To ensure object processing is efficient and fast, you should split your lifecycle rule runs and use Filters to minimize the number of objects that need to be processed.&#x20;
* You can only create lifecycle rules of 1 of 2 types (transition, expiration) on 1 container in any 1 project. For example, if you have set a lifecycle rule of type transition for container01, you cannot set another lifecycle rule of type expiration for container01 and vice versa.&#x20;
* If you set a transition type lifecycle rule for a container, you can only create a maximum of 1 transition rule.&#x20;
* If you set up an expiration type lifecycle rule for 1 container, you can create up to 10 expiration rules.
{% endhint %}

To create a lifecycle for a container, you can do so via vStorage Portal according to the instructions below:

1. Log in to [https://vstorage.console.vngcloud.vn](https://vstorage.console.vngcloud.vn).
2. Select the **project** and choose the **container** for which you want to set up the lifecycle.
3. Click ![](http://docs.vngcloud.vn/download/thumbnails/67994132/image2023-3-6\_10-35-20.png?version=1\&modificationDate=1700794658000\&api=v2)on the container icon or select ![](http://docs.vngcloud.vn/download/thumbnails/67994132/image2023-2-6\_10-20-54.png?version=1\&modificationDate=1700794658000\&api=v2) it to use the container lifecycle feature and click ![](http://docs.vngcloud.vn/download/thumbnails/67994132/image2023-11-27\_8-54-59.png?version=1\&modificationDate=1701050101000\&api=v2)
4. The **Lifecycle screen** appears. Choose **Create a lifecycle rule**.
5. Enter the Lifecycle **Rule Name**. The allowed characters for the Lifecycle Rule Name include letters (a-z, A-Z), numbers (0-9), '\_', and '-'. The length of your Lifecycle **Rule Name** must be between 5 and 50.
6. Select the **Rule Type** and enter a **Rule Description** if necessary. We provide you with two types of rules:
   1. Transition: Rule to support moving objects between storage classes.
   2. Expiration: Rule to support deleting objects based on specified conditions.
7. Enter the **Filter**. This filter applies to a specific lifecycle rule. Each lifecycle rule can have only one filter, and we provide you with filtering options, including:
   1. If you want to search for objects based on Prefix:
      1. Select **Prefix**.
      2. Enter the prefix string you want to search for.
   2. If you want to search for objects based on Wildcard:
      1. Select **Wildcard**.
      2. Enter the wildcard string you want to search for.
   3. If you want to search for objects based on Regex:
      1. Select **Regex**.
      2. Enter the regex string you want to search for.

For example, if you want to search for objects with a common prefix in the object name as **file,** you need to set up the filter as follows:

* Select **Prefix**
* Enter the prefix **file**

You can learn more about how we search results using each method in the table below:

<table data-header-hidden data-full-width="true"><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td><strong>Search by</strong></td><td><strong>Example syntax</strong></td><td>Search result</td><td>Description</td></tr><tr><td>Name match by prefix</td><td><p>Name match by prefix <strong>abc</strong> (object in the container)</p><p>Name match by prefix <strong>directoryA/abc</strong> (object in directoryA)</p></td><td><strong>abc1, abc2</strong>,…distinguish between lower case and lower case.</td><td>Search by comparing the entered string with the prefix of the object's name.</td></tr><tr><td><p>Name match by wildcard</p><p><strong>(Comming soon)</strong></p></td><td><p>Name match by wildcard <strong>ab</strong><em><strong>c</strong> (object in the container)</em></p><p><em>Name match by wildcard <strong>?abc?</strong> (object in the container)</em></p><p><em>Name match by wildcard <strong>abc</strong></em><strong>.?xt</strong> (object in the container)</p><p>Name match by wildcard <strong>ab*c.txt</strong> (object in the container)</p><p>Name match by wildcard <strong>directoryA/ab</strong><em><strong>c</strong> (object in the directoryA)</em></p><p><em>Name match by wildcard <strong>directoryA/?abc?</strong> (object in the directoryA)</em></p><p><em>Name match by wildcard <strong>directoryA/abc</strong></em><strong>.?xt</strong> (object in the directoryA)</p><p>Name match by wildcard <strong>directoryA/ab*c.txt</strong> (object in the directoryA)</p></td><td><p><strong>abc, abdc, ab)c, abUUc, ab&#x26;-Bc</strong>…distinguish between lower case and lower case.</p><p><strong>1abcx, -abc*, 1abcD,…</strong> distinguish between lower case and lower case.</p><p><strong>abc.txt, abc123.^xt,</strong>… distinguish between lower case and lower case.</p><p><strong>ab*c.txt</strong> distinguish between lower case and lower case.</p></td><td><p><em>: 0 tới n ký tự bất kỳ, ký tự này có thể là chữ cái in hoa, in thường, ký tự số hoặc ký tự đặc biệt.</em></p><p><em><strong>?</strong>: 1 ký tự bất kỳ, ký tự này có thể là chữ cái in hoa, in thường, ký tự số hoặc ký tự đặc biệt.</em></p><p><em><strong>&#x3C;/strong></strong></em><strong>, &#x3C;/strong>?: ký tự *, ? lúc này được coi là một ký tự trong bình thường, không phải là toán tử đại diện sử dụng để search.</strong></p></td></tr><tr><td><p>Name match by regex</p><p><strong>(Comming soon)</strong></p><p><br></p></td><td><p>Name match by regex <strong>ab.</strong> (object in the container)</p><p>Name match by regex <strong>directoryA/ab.</strong> (object in the directoryA)</p></td><td><strong>ab1,ab2,ab3, abx, ab*,</strong>… distinguish between lower case and lower case.</td><td><strong>.</strong>: Matches any character</td></tr><tr><td><strong>ab, abc</strong> distinguish between lower case and lower case.</td><td><strong>?</strong>: Repeat the preceding character zero or one times. Often used to make the preceding character optional.</td><td></td><td></td></tr><tr><td><strong>ab, abb, abbb</strong>,… distinguish between lower case and lower case.</td><td><strong>+</strong>: Repeat the preceding character one or more times.</td><td></td><td></td></tr><tr><td><strong>a, ab, abb, abbb</strong>,… distinguish between lower case and lower case.</td><td><strong>*</strong>: Repeat the preceding character zero or more times.</td><td></td><td></td></tr><tr><td><p><strong>aa</strong> distinguish between lower case and lower case.</p><p><strong>aa, aaa, aaaa</strong> distinguish between lower case and lower case.</p><p><strong>aa, aaa, aaaa, aaaaa,</strong>… distinguish between lower case and lower case.</p></td><td>{}: Minimum and maximum number of times the preceding character can repeat.</td><td></td><td></td></tr><tr><td><p>xyz (object in the container)</p><p>Name match by regex <strong>directoryA/abc</strong></p></td><td>xyz (object in the directoryA)</td><td><strong>abc, xyz</strong> distinguish between lower case and lower case.</td><td>|: OR operator. The match will succeed if the longest pattern on either the left side OR the right side matches.</td></tr><tr><td><strong>abc, abcxyz</strong> distinguish between lower case and lower case.</td><td>(): Forms a group. You can use a group to treat part of the expression as a single character.</td><td></td><td></td></tr><tr><td><p><strong>a, b, c</strong> distinguish between lower case and lower case.</p><p><strong>a, b, c, d</strong> distinguish between lower case and lower case.</p><p><strong>khác a, b, c, hoặc -</strong> distinguish between lower case and lower case.</p></td><td><p>[ ]: Match one of the characters in the brackets.</p><p>A <code>^</code> before a character in the brackets negates the character or range</p><p>: OR</p></td><td></td><td></td></tr><tr><td><strong>aaaaaaa, aaaaaaaaaaaaddddd,</strong>… distinguish between lower case and lower case.</td><td>Use nested operators within a regex search syntax.</td><td></td><td></td></tr></tbody></table>

When you choose:

| <p><strong>The transition rule will move objects that meet certain conditions from the Gold storage class to the Silver storage class. Currently, the transition feature is only supported for:</strong></p><ul><li><strong>Moving objects for postpaid customer accounts.</strong></li><li><strong>Moving objects from the Gold container to the Silver container.</strong></li><li><strong>Moving objects from the Gold container to the Archive container.</strong></li></ul><p>8. Choose the destination and time when objects are moved</p><ul><li><strong>Transition to</strong>: select vStorage Silver.</li><li>Then enter the <strong>number of days</strong> since the last time the object was accessed (Get/Download request).</li></ul><p>After you successfully create a new Lifecycle rule of transition type,</p><ul><li>If you choose Transition to: vStorage Silver, the vStorage system will automatically create a container with a tier suffix. This container will be used as a place to store transited objects. For example, when you create a lifecycle rule of type Transition to: vStorage Silver for Container01, the system will automatically create Container01_tier (storage class Silver). Within 5 hours from when the lifecycle rule is created, the vStorage system will run the rule, objects that satisfy the conditions will be moved from Container01 to Container01_tier with the object URL unchanged.</li></ul><ul><li>If you select Transition to: vStorage Archive, the vStorage system will automatically create a container with the archive_tier suffix. This container will be used as a place to store transited objects. For example, when you create a lifecycle rule of type Transition to: vStorage Archive for Container01, the system will automatically create Container01_archive_tier (storage class archive). Within 5 hours from when the lifecycle rule is created, the vStorage system will run the rule, objects that satisfy the conditions will be moved from Container01 to Container01_archive_tier with the object URL unchanged.</li></ul> |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

***

| <p><strong>Expiration rule will delete objects in the container based on certain conditions. Currently, the expiration feature supports:</strong></p><ul><li><strong>Deleting objects for both pre-paid and post-paid customer accounts.</strong></li><li><strong>Deleting objects in Gold, Silver, and Archive containers. (For Archive containers, the minimum number of days to perform object deletion is 180 days).</strong></li></ul><p>8. Select the action that occurs with objects in the chosen container, including:</p><ul><li><strong>Expire current versions of objects</strong>: Use when you want to set up the deletion of objects in the original container based on a period of time from the date the object exists in the vStorage system. This rule applies to deleting objects in non-versioning containers. When you choose this setting, you need to enter the number of days from the object's initialization.</li><li><strong>Permanently delete previous versions:</strong> Use when you want to set up the deletion of objects in the corresponding version container of the original container based on a period of time from when the versioned object was created. This rule applies to deleting objects in versioned containers. When you choose this setting, you need to enter the number of days from when the object becomes an old version (meaning the object exists in the versioned container).</li><li><strong>Expire marked-deleted objects:</strong> Use when you want to set up the deletion of files marked as deleted generated in versioned containers. (Delete marked files are files generated when you delete an object in the original container that has versioning enabled). This rule applies to deleting objects in versioned containers.</li></ul><p>After you successfully create a new Lifecycle rule with expiration type, within 2 hours from the time the lifecycle rule is created, the vStorage system will run the rule, objects that satisfy the conditions will be deleted.</p><p><em><strong>Refer to the 2 examples below to understand how the expiration rule works:</strong></em></p><p><em><strong>Example 1</strong></em>: <em>you have created container01 (container01 has not enabled container versioning yet). Now you need to set up a rule according to the rule: if the objects are not accessed for 60 days, the system will delete them. Now you will set up expiration rules as follows:</em></p><p><img src="../../../../.gitbook/assets/image (3).png" alt="" data-size="original"></p><p><em>Within 2 hours from the time this lifecycle rule is created, the vStorage system will run the rule, check the objects in container01 and delete objects that meet the 60-day inaccessible condition.</em></p><p><em><strong>Example 2:</strong></em> <em>you have created container01 (container01 has container versioning enabled). Now you need to set up a rule according to the rule: if the objects are not accessed for 60 days, the system will delete them. Now you will set up expiration rules as follows:</em></p><p><img src="../../../../.gitbook/assets/image (4).png" alt="" data-size="original"></p><p></p><p><em>Within 2 hours from the time this lifecycle rule is created, the vStorage system will run the rule, check the objects in container01, container01_version and do:</em></p><ul><li><em>Delete objects belonging to container01 that satisfy the 60-day inaccessibility condition.</em></li></ul><ul><li><em>Delete objects belonging to container01_version that satisfy the 60-day condition to become the old version (ie the object exists in container01_version for 60 days).</em></li></ul><ul><li><em>Delete the delete marker files generated in container01_version.</em></li></ul> |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
